<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Normalization · Wannier.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Wannier.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../start/">Getting Started</a></li><li><span class="tocitem">Examples</span></li><li><span class="tocitem">Theory</span><ul><li class="is-active"><a class="tocitem" href>Normalization</a><ul class="internal"><li><a class="tocitem" href="#Continuous-case"><span>Continuous case</span></a></li><li><a class="tocitem" href="#Discretized-case"><span>Discretized case</span></a></li><li><a class="tocitem" href="#Real-space-representation"><span>Real space representation</span></a></li></ul></li><li><a class="tocitem" href="../discretization/"><span>$k$</span>-space Discretization</a></li><li><a class="tocitem" href="../initial_projection/">Initial projection</a></li><li><a class="tocitem" href="../algorithm/">Localization</a></li><li><a class="tocitem" href="../fourier/">Wannier Interpolation</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../api/util/">Utility</a></li><li><a class="tocitem" href="../../api/io/">Input/Output</a></li><li><a class="tocitem" href="../../api/model/">Model</a></li><li><a class="tocitem" href="../../api/bvector/"><span>$b$</span>-vector</a></li><li><a class="tocitem" href="../../api/wannierize/">Localization</a></li><li><a class="tocitem" href="../../api/realspace/">Real space</a></li><li><a class="tocitem" href="../../api/interpolation/">Interpolation</a></li><li><a class="tocitem" href="../../api/cli/">Command line</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Theory</a></li><li class="is-active"><a href>Normalization</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Normalization</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/qiaojunfeng/Wannier.jl/blob/main/docs/src/theory/normalization.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Normalization-convention-of-WFs"><a class="docs-heading-anchor" href="#Normalization-convention-of-WFs">Normalization convention of WFs</a><a id="Normalization-convention-of-WFs-1"></a><a class="docs-heading-anchor-permalink" href="#Normalization-convention-of-WFs" title="Permalink"></a></h1><p>There are several different conventions for Fourier transform, this page describes the normalization convention used in <code>Wannier.jl</code>. In short, we adopt the same convention as the Section II 3 of <sup class="footnote-reference"><a id="citeref-RMP" href="#footnote-RMP">[RMP]</a></sup>.</p><p>For a unit cell having volume <span>$V$</span>, the Bloch functions <span>$| \psi \rangle$</span> are periodic in a super cell which is <span>$N$</span> times the unit cell (thus having volume <span>$NV$</span>), where <span>$N$</span> is determined by the discretization of the reciprocal space, i.e. the total number of kpoints.</p><h2 id="Continuous-case"><a class="docs-heading-anchor" href="#Continuous-case">Continuous case</a><a id="Continuous-case-1"></a><a class="docs-heading-anchor-permalink" href="#Continuous-case" title="Permalink"></a></h2><p>If the super cell is large enough (<span>$N \to \infty$</span>), then the kpoint <span>$\bm{k}$</span> is a continuous variable in the reciprocal cell having volume <span>$\frac{(2\pi)^3}{V}$</span>. The inner product between bra and ket <span>$\langle f | g \rangle$</span> are integrated over the the <span>$NV$</span> super cell that is <span>$(-\infty, \infty)$</span> in the continuous case. If we normalize the Bloch functions over one unit cell, that is,</p><p class="math-container">\[\langle \psi_{n \bm{k}} | \psi_{n \bm{k}} \rangle_V
= \int_V | u_{n \bm{k}}(\bm{r}) |^2 \bm{r} = 1,\]</p><p>where <span>$\psi_{n \bm{k}} = \exp(i \bm{k} \bm{r}) u_{n \bm{k}}(\bm{r})$</span>, then the inner product between bra and ket is</p><p class="math-container">\[\langle \psi_{n \bm{k}} | \psi_{m \bm{k^\prime}} \rangle
= \frac{(2\pi)^3}{V} \delta_{n m} \delta(\bm{k} - \bm{k^\prime}).\]</p><p>This can be proven, e.g. in 1D with periodicity <span>$\bm{R}$</span>, by</p><p class="math-container">\[\begin{aligned}
&amp; \langle \psi_{n \bm{k}} | \psi_{m \bm{k^\prime}} \rangle
= \int_{-\infty}^{+\infty} \psi_{n \bm{k}}^* \psi_{m \bm{k^\prime}} d\bm{r} \\
= &amp; \int_{-\infty}^{+\infty} \exp(i (\bm{k^\prime} - \bm{k}) \bm{r})
    u_{n \bm{k}}^*(\bm{r}) u_{m \bm{k^\prime}}(\bm{r}) d\bm{r} \\
= &amp; \sum_{l = -\infty}^{+\infty} \int_{l \bm{R}}^{(l+1) \bm{R}} d(\bm{r} + l \bm{R})
    \exp(i (\bm{k^\prime} - \bm{k}) (\bm{r} + l \bm{R}))
    u_{n \bm{k}}^*(\bm{r} + l \bm{R}) u_{m \bm{k^\prime}}(\bm{r} + l \bm{R}) \\
= &amp; \sum_{l = -\infty}^{+\infty} \exp(i (\bm{k^\prime} - \bm{k}) l \bm{R})
    \int_{0}^{\bm{R}} d\bm{r} \exp(i (\bm{k^\prime} - \bm{k}) \bm{r})
    u_{n \bm{k}}^*(\bm{r}) u_{m \bm{k^\prime}}(\bm{r}) d\bm{r} \\
= &amp; \frac{2\pi}{\bm{R}} \operatorname{\text{Ш}}_{\frac{2\pi}{\bm{R}}}(\bm{k^\prime} - \bm{k})
    \int_{0}^{\bm{R}} \psi_{n \bm{k}}^* \psi_{m \bm{k^\prime}} d\bm{r} \\
= &amp; \frac{2\pi}{\bm{R}} \delta(\bm{k} - \bm{k^\prime}) \delta_{n m}.
\end{aligned}\]</p><p>In the third line of the above equation, we replace the real space coordinate <span>$\bm{r}$</span> by <span>$\bm{r} + l \bm{R}$</span>, such that <span>$\bm{r} \in [0, \bm{R})$</span>. In the fourth line, we utilize the real space periodicity of <span>$u_{n \bm{k}}$</span>. In the second last line, the <a href="https://en.wikipedia.org/wiki/Dirac_comb">Dirac comb</a> <span>$\operatorname{\text{Ш}}_{T}(t)$</span> having periodicity <span>$T$</span> can be expanded as a <a href="https://en.wikipedia.org/wiki/Fourier_series">Fourier series</a></p><p class="math-container">\[\operatorname {\text{Ш}} _{T}(t) =
{\frac {1}{T}} \sum _{n=-\infty }^{\infty }e^{i2\pi n{\frac {t}{T}}}.\]</p><p>In the last line, the Bloch function <span>$| \psi \rangle$</span> is periodic in <span>$\bm{k}$</span> thus the Dirac comb is reduced to a Dirac delta function <span>$\delta(\bm{k} - \bm{k^\prime})$</span>, and of course the normalization of <span>$| \psi \rangle$</span> over one unit cell is used in the last line.</p><p>Thus, the Bloch functions are orthogonal w.r.t. <span>$\bm{k}$</span> only in the <strong>super cell</strong>, they are <strong>not</strong> orthogonal when only integrating over <strong>one unit cell</strong>.</p><h2 id="Discretized-case"><a class="docs-heading-anchor" href="#Discretized-case">Discretized case</a><a id="Discretized-case-1"></a><a class="docs-heading-anchor-permalink" href="#Discretized-case" title="Permalink"></a></h2><p>For finite sampling of reciprocal space, e.g. a 1D cell of periodicity <span>$\bm{R}$</span>, sampled by <span>$N$</span> kpoints, then <span>$\bm{k} = \frac{2\pi}{\bm{R}}\frac{n}{N}, n = 0, 1, ..., N-1$</span>. The inner product between bra and ket is</p><p class="math-container">\[\begin{aligned}
&amp; \langle \psi_{n \bm{k}} | \psi_{m \bm{k^\prime}} \rangle
= \int_{0}^{N \bm{R}} \psi_{n \bm{k}}^* \psi_{m \bm{k^\prime}} d\bm{r} \\
= &amp; \sum_{l = 0}^{N-1} \exp(i (\bm{k^\prime} - \bm{k}) l \bm{R})
    \int_{0}^{\bm{R}} \psi_{n \bm{k}}^* \psi_{m \bm{k^\prime}} d\bm{r} \\
= &amp; N \delta_{\bm{k},\bm{k^\prime}} \delta_{n m}.
\end{aligned}\]</p><p>The second last line uses the fact that the <a href="https://en.wikipedia.org/wiki/Discrete_Fourier_transform">discrete Fourier transform</a> of Dirac delta function is 1,</p><p class="math-container">\[{\mathcal {F}}(\delta_{n})_{k} =
    \sum_{n=0}^{N-1} \delta_{n} \cdot e^{-{\frac{i2\pi }{N}} kn}
    = 1, k = 0, 1, ..., N-1.\]</p><p>so that the delta function can be represented by</p><p class="math-container">\[\delta_{n} = \frac{1}{N} \sum_{k=0}^{N-1} e^{{\frac{i2\pi }{N}} kn}\]</p><h2 id="Real-space-representation"><a class="docs-heading-anchor" href="#Real-space-representation">Real space representation</a><a id="Real-space-representation-1"></a><a class="docs-heading-anchor-permalink" href="#Real-space-representation" title="Permalink"></a></h2><p>In the discrete case, the WFs are the discrete Fourier transform of the Bloch function,</p><p class="math-container">\[| \bm{R} n \rangle = \frac{1}{N} \sum_{\bm{k}}
    e^{-i \bm{k} \bm{R}} | \psi_{n \bm{k}} \rangle.\]</p><p>Note the factor <span>$\frac{1}{N}$</span> is multiplied in the forward transform, while the inverse transform is</p><p class="math-container">\[| \psi_{n \bm{k}} \rangle = \sum_{\bm{k}} e^{i \bm{k} \bm{R}} | \bm{R} n \rangle.\]</p><p>Then the orthonormalization relation of WFs are (note the inner product is integrated over the super cell <span>$NV$</span>)</p><p class="math-container">\[\begin{aligned}
&amp; \langle \bm{R} n | \bm{R^\prime} m \rangle \\
= &amp; \frac{1}{N^2} \sum_{\bm{k},\bm{k^\prime}} e^{i \bm{k} \bm{R} - i \bm{k^\prime} \bm{R^\prime}}
    \langle \psi_{n \bm{k}} | \psi_{m \bm{k^\prime}} \rangle \\
= &amp; \frac{1}{N^2} \sum_{\bm{k},\bm{k^\prime}} e^{i \bm{k} \bm{R} - i \bm{k^\prime} \bm{R^\prime}}
    N \delta_{\bm{k},\bm{k^\prime}} \delta_{n m} \\
= &amp; \frac{1}{N} \delta_{n m} \sum_{\bm{k}} e^{i \bm{k} (\bm{R} - \bm{R^\prime})} \\
= &amp; \frac{1}{N} \delta_{n m} N \delta_{\bm{R}, \bm{R^\prime}}
= \delta_{n m} \delta_{\bm{R}, \bm{R^\prime}}.
\end{aligned}\]</p><h3 id="Implementation-details"><a class="docs-heading-anchor" href="#Implementation-details">Implementation details</a><a id="Implementation-details-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation-details" title="Permalink"></a></h3><ul><li><p>The <code>UNK</code> files (generated by <code>QE</code> <code>pw2wannier90.x</code>) are not normalized to 1 in the unit cell (instead to <span>$N = N_x \times N_y \times N_z$</span>, where <span>$N_x, N_y, N_z$</span> are the number of points of the real space grid), so we need to multiply a factor of <span>$\frac{1}{\sqrt{N}}$</span>. This is done in the <a href="theory/@ref read_realspace_wf"><code>read_realspace_wf</code></a> function.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>This means for other DFT codes to interface with <code>Wannier.jl</code>, the output <code>UNK</code>s need to be normalized to <span>$N$</span> in the unit cell, otherwise the real space computations, e.g., <a href="../../api/model/#Wannier.center-Tuple{Wannier.KspaceStencil, Any, Any}"><code>center(rgrid::RGrid, W::AbstractArray)</code></a>, are wrong!</p></div></div></li><li><p>Then calculating the WF center in real space can be easily achieved in <a href="../../api/model/#Wannier.center-Tuple{Wannier.KspaceStencil, Any, Any}"><code>center(rgrid::RGrid, W::AbstractArray)</code></a>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This is not as accurate as computing WF center in reciprocal space, unless you have a dense real space sampling (usually determined by the energy cutoff in plane-wave code), and generate the real space WF in the <span>$NV$</span>-sized super cell (the WF lives in the super cell!).</p></div></div></li><li><p>However, <code>Wannier90</code> does not consider this factor when writing <code>xsf</code> or <code>cube</code> files, so we remove the factor in <a href="theory/@ref write_realspace_wf"><code>write_realspace_wf</code></a> function, such that</p><ul><li>the output file is consistent with <code>Wannier90</code> output.</li><li>another advantage is that WF is normalized in one unit cell, so the numbers in the <code>xsf</code> are not too small.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Somehow the <code>Wannier90</code> output <code>xsf</code> or <code>cube</code> is on a slightly shifted grid, in <a href="theory/@ref write_realspace_wf"><code>write_realspace_wf</code></a> we just output the WF on the unshifted grid so that the origin of the WF 3D mesh is the same as the lattice origin (or its periodic replicas translated by lattice vectors).</p></div></div></li></ul><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-RMP"><a class="tag is-link" href="#citeref-RMP">RMP</a>Marzari, N.; Mostofi, A. A.; Yates, J. R.; Souza, I. &amp; Vanderbilt, D., Maximally localized Wannier functions: Theory and applications, <a href="https://dx.doi.org/10.1103/revmodphys.84.1419">Reviews of Modern Physics, 2012, 84, 1419</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../start/">« Getting Started</a><a class="docs-footer-nextpage" href="../discretization/"><span>$k$</span>-space Discretization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 4 August 2023 08:56">Friday 4 August 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
