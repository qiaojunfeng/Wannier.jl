<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Initial projection · Wannier.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Wannier.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../start/">Getting Started</a></li><li><span class="tocitem">Examples</span></li><li><span class="tocitem">Theory</span><ul><li><a class="tocitem" href="../normalization/">Normalization</a></li><li><a class="tocitem" href="../discretization/"><span>$k$</span>-space Discretization</a></li><li class="is-active"><a class="tocitem" href>Initial projection</a><ul class="internal"><li><a class="tocitem" href="#Bloch-wavefunction"><span>Bloch wavefunction</span></a></li><li><a class="tocitem" href="#Localized-atomic-orbitals"><span>Localized atomic orbitals</span></a></li><li><a class="tocitem" href="#Bloch-sum"><span>Bloch sum</span></a></li><li><a class="tocitem" href="#Fourier-transform-to-plane-waves"><span>Fourier transform to plane waves</span></a></li><li><a class="tocitem" href="#Inner-product"><span>Inner product</span></a></li><li><a class="tocitem" href="#Appendix:-Hankel-transform"><span>Appendix: Hankel transform</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../algorithm/">Localization</a></li><li><a class="tocitem" href="../fourier/">Wannier Interpolation</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../api/util/">Utility</a></li><li><a class="tocitem" href="../../api/io/">Input/Output</a></li><li><a class="tocitem" href="../../api/model/">Model</a></li><li><a class="tocitem" href="../../api/bvector/"><span>$b$</span>-vector</a></li><li><a class="tocitem" href="../../api/wannierize/">Localization</a></li><li><a class="tocitem" href="../../api/realspace/">Real space</a></li><li><a class="tocitem" href="../../api/interpolation/">Interpolation</a></li><li><a class="tocitem" href="../../api/cli/">Command line</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Theory</a></li><li class="is-active"><a href>Initial projection</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Initial projection</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/qiaojunfeng/Wannier.jl/blob/main/docs/src/theory/initial_projection.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Initial-projection-for-plane-wave-DFT-codes"><a class="docs-heading-anchor" href="#Initial-projection-for-plane-wave-DFT-codes">Initial projection for plane-wave DFT codes</a><a id="Initial-projection-for-plane-wave-DFT-codes-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-projection-for-plane-wave-DFT-codes" title="Permalink"></a></h1><p>Here I write down the formulae for initial projection in plane-wave DFT codes, e.g., as implemented in <code>DFTK.jl</code> or <code>Quantum ESPRESSO</code>.</p><p>In essence, the initial projection <span>$A_{m n \mathbf{k}}$</span> is the inner product between the Bloch wavefunction <span>$\psi_{m \mathbf{k}}(\mathbf{r})$</span> and some initial guess <span>$\phi_{n \mathbf{k}}(\mathbf{r})$</span>,</p><p class="math-container">\[A_{m n \mathbf{k}} = \langle \psi_{m \mathbf{k}} | \phi_{n \mathbf{k}} \rangle.\]</p><h2 id="Bloch-wavefunction"><a class="docs-heading-anchor" href="#Bloch-wavefunction">Bloch wavefunction</a><a id="Bloch-wavefunction-1"></a><a class="docs-heading-anchor-permalink" href="#Bloch-wavefunction" title="Permalink"></a></h2><p>The Bloch wavefunction is expanded in plane waves,</p><p class="math-container">\[\psi_{m \mathbf{k}}(\mathbf{r}) = \frac{1}{\sqrt{V}} \sum_{\mathbf{G}}
  c_{m \mathbf{k}}(\mathbf{G}) e^{i (\mathbf{k} + \mathbf{G}) \mathbf{r}},\]</p><p>where <span>$V$</span> is the volume of the unit cell, the sum is over the plane-wave expansions (integer multiples of reciprocal lattice vectors) <span>$\mathbf{G}$</span>, which are limited by the energy cutoff <span>$E_{\mathrm{cut}}$</span>,</p><p class="math-container">\[\frac{\hbar^2}{2 m_e} | \mathbf{k} + \mathbf{G} |^2 \leq E_{\mathrm{cut}},\]</p><p>where <span>$m_e$</span> is the electron mass. The coefficients <span>$c_{m \mathbf{k}}(\mathbf{G})$</span> are obtained from DFT calculations.</p><h2 id="Localized-atomic-orbitals"><a class="docs-heading-anchor" href="#Localized-atomic-orbitals">Localized atomic orbitals</a><a id="Localized-atomic-orbitals-1"></a><a class="docs-heading-anchor-permalink" href="#Localized-atomic-orbitals" title="Permalink"></a></h2><p>Usually we choose some atomic orbitals as the initial projections, given by a product of radial function <span>$R(r)$</span> times spherical harmonics <span>$Y_{l m}(\theta, \phi)$</span>,</p><p class="math-container">\[f(\mathbf{r}) = R(r) Y_{l m}(\theta, \phi),\]</p><p>where <span>$\mathbf{r}$</span> is the vector and <span>$r = |\mathbf{r}|$</span> is its norm; <span>$\theta$</span> and <span>$\phi$</span> are the polar and azimuthal angles or <span>$\mathbf{r}$</span>, respectively; <span>$l$</span> and <span>$m$</span> are the angular momentum, and the <span>$Y_{l m}(\theta, \phi)$</span> are the real spherical harmonics (as a comparison, we use the notation <span>$Y_{l}^{m}(\theta, \phi)$</span> for the complex spherical harmonics, see <sup class="footnote-reference"><a id="citeref-SphHarm" href="#footnote-SphHarm">[SphHarm]</a></sup>).</p><h2 id="Bloch-sum"><a class="docs-heading-anchor" href="#Bloch-sum">Bloch sum</a><a id="Bloch-sum-1"></a><a class="docs-heading-anchor-permalink" href="#Bloch-sum" title="Permalink"></a></h2><p>The atomic orbitals do not have the periodicity of the lattice, so we need to sum over the lattice to obtain the Bloch sum of the localized atomic orbitals,</p><p class="math-container">\[\phi_{\mathbf{k}}(\mathbf{r}) = \frac{1}{N \sqrt{V}} \sum_{\mathbf{R}}
  e^{i \mathbf{k} \mathbf{R}} f(\mathbf{r} - \mathbf{R}),\]</p><p>where <span>$N$</span> is the number of unit cells in the supercell (determined by the k-point mesh), <span>$V$</span> is the volume of unit cell, and <span>$\mathbf{R}$</span> labels the unit cell inside the supercell.</p><h2 id="Fourier-transform-to-plane-waves"><a class="docs-heading-anchor" href="#Fourier-transform-to-plane-waves">Fourier transform to plane waves</a><a id="Fourier-transform-to-plane-waves-1"></a><a class="docs-heading-anchor-permalink" href="#Fourier-transform-to-plane-waves" title="Permalink"></a></h2><p>To obtain the inner product between the Bloch wavefunction and the Bloch sum of the localized atomic orbitals, we need to Fourier transform the Bloch sum to plane waves, i.e., compute inner product in <span>$\mathbf{G}$</span>-vector space.</p><p>For a wavefunction having a form of radial functions times spherical harmonics, i.e., <span>$f(\mathbf{r}) = R(r) Y_{l m}(\theta, \phi)$</span>, its Fourier transform <span>$\hat{f}( \mathbf{q} )$</span> can be computed by</p><p class="math-container">\[\begin{aligned}
\hat{f}(\mathbf{q})
&amp;= \int_{{\mathbb R}^{3}} e^{-i \mathbf{q} \cdot \mathbf{r}} f(\mathbf{r}) d\mathbf{r} \\
&amp;= 4 \pi Y_{l m}(\mathbf{q}/q) (-i)^{l}
  \int_{{\mathbb R}^+} r^2 R(r) \ j_{l}(q r) dr,
\end{aligned}\]</p><p>where <span>$q = |\mathbf{q}|$</span>, and <span>$j_{l}(x)$</span> is the spherical Bessel function of the first kind <sup class="footnote-reference"><a id="citeref-SphBess" href="#footnote-SphBess">[SphBess]</a></sup>.</p><p>Here we have used the plane wave expansion in spherical harmonics <sup class="footnote-reference"><a id="citeref-PwExpand" href="#footnote-PwExpand">[PwExpand]</a></sup> (valid for both complex and real spherical harmonics),</p><p class="math-container">\[\begin{aligned}
  e^{i \mathbf{q} \cdot \mathbf{r}}
&amp;= 4 \pi \sum_{l=0}^{\infty} \sum_{m=-l}^{l}
    i^{l} j_{l}(q r) Y_{l}^{m}(\mathbf{q}/q) Y_{l}^{m*}(\mathbf{r}/r) \\
&amp;= 4 \pi \sum_{l=0}^{\infty} \sum_{m=-l}^{l}
    i^{l} j_{l}(q r) Y_{l m}(\mathbf{q}/q) Y_{l m}(\mathbf{r}/r)
\end{aligned}\]</p><p>For <span>$e^{-i \mathbf{q} \cdot \mathbf{r}}$</span>, due to the parity of spherical harmonics, <span>$Y_{l}^{m}(- \mathbf{r} ) = (-1)^{l} Y_{l}^{m}( \mathbf{r} )$</span> (also hold true for real spherical harmonics <span>$Y_{l m}(- \mathbf{r} ) = (-1)^{l} Y_{l m}( \mathbf{r} )$</span>), the <span>$i^l$</span> in the expression of <span>$e^{i \mathbf{q} \cdot \mathbf{r}}$</span> becomes <span>$(-i)^l$</span> in that of <span>$e^{-i \mathbf{q} \cdot \mathbf{r}}$</span>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>To really convince you that there should be a minus sign, I created a notebook which includes some numerical tests, <a href="../pluto_fourier.html">click here to download</a>.</p></div></div><p>Now, using the orthogonality of spherical harmonics,</p><p class="math-container">\[\int_{\theta = 0}^{\pi} \int_{\phi=0}^{2\pi}
Y_{l}^{m} Y_{l^{\prime}}^{m^{\prime} *} d\Omega
= \delta_{l l^{\prime}} \delta_{m m^{\prime}},\]</p><p>we reach the expression of <span>$\hat{f}(\mathbf{q})$</span>. Note in the above equation <span>$d\Omega = \sin \theta d\theta d\phi$</span> is the solid angle element, and <span>$dV = r^2 dr d\Omega$</span> is the volume element.</p><p>Note that alternatively, we can use Hankel transform to reach the same result, see <a href="#Appendix:-Hankel-transform">Appendix: Hankel transform</a>.</p><p>Thus, <span>$f(\mathbf{r})$</span> can be expanded as</p><p class="math-container">\[f(\mathbf{r}) = \frac{1}{(2\pi)^3} \int d\mathbf{q} \hat{f}(\mathbf{q})
\exp(i \mathbf{q} \cdot \mathbf{r}).\]</p><p>Then the Fourier transform of the Bloch sum is</p><p class="math-container">\[\begin{aligned}
\phi_{\mathbf{k}}(\mathbf{q})
&amp;= \mathcal{F}_{\mathbf{r} \rightarrow \mathbf{q}}
  \{ \phi_{\mathbf{k}} (\mathbf{r} - \mathbf{\tau}) \} \\
&amp;= \mathcal{F} \{ \frac{1}{N \sqrt{V}}
  \sum_{\mathbf{R}} \exp(i \mathbf{k} \mathbf{R})
  f(\mathbf{r} - \mathbf{\tau} - \mathbf{R}) \} \\
&amp;= \frac{1}{N \sqrt{V}} \sum_{\mathbf{R}}
  \exp(i \mathbf{k} \mathbf{R})
  \mathcal{F} \{ f(\mathbf{r} - \mathbf{\tau} - \mathbf{R}) \} \\
&amp;= \frac{1}{N \sqrt{V}} \sum_{\mathbf{R}}
  \exp(i \mathbf{k} \mathbf{R})
  \hat{f}(\mathbf{q}) \exp(-i \mathbf{q} (\mathbf{\tau} + \mathbf{R}) ),
\end{aligned}\]</p><p>where <span>$\mathbf{\tau} = (\tau_x, \tau_y, \tau_z)$</span> is the center of the orbital.</p><h2 id="Inner-product"><a class="docs-heading-anchor" href="#Inner-product">Inner product</a><a id="Inner-product-1"></a><a class="docs-heading-anchor-permalink" href="#Inner-product" title="Permalink"></a></h2><p>Now we can compute the initial projection <span>$A_{m n \mathbf{k}}$</span>. Note that the Bloch state <span>$\psi_{n \mathbf{k}}(\mathbf{r})$</span> are actually a sum over <span>$e^{i (\mathbf{k} + \mathbf{G}) \mathbf{r}}$</span>, so we need to set the <span>$\mathbf{q}$</span> in <span>$\phi_{\mathbf{k}}(\mathbf{q})$</span> to <span>$\mathbf{k} + \mathbf{G}$</span> so that the inner product is on the same basis functions.</p><p class="math-container">\[\phi_{\mathbf{k}}(\mathbf{k + G})
= \frac{1}{\sqrt{V}} \exp(-i (\mathbf{k + G}) \mathbf{\tau} )
  \hat{f}(\mathbf{k + G}).\]</p><p>Since the localized orbitals <span>$f(\mathbf{r})$</span> might not be normalized, often we apply Löwdin orthonormalization on the <span>$\mathbf{q}$</span>-space wavefunction <span>$\phi_{\mathbf{k}}(\mathbf{q})$</span> at each <span>$\mathbf{k}$</span>-point.</p><p>Finally, the initial projection is</p><p class="math-container">\[\begin{aligned}
A_{m n \mathbf{k}}
&amp;= \psi_{m \mathbf{k}}^* \phi_{n \mathbf{k}} \\
&amp;= \sum_{\mathbf{G}} c_{m \mathbf{k}}(\mathbf{G})^* \phi_{n \mathbf{k}}(\mathbf{k + G}).
\end{aligned}\]</p><h2 id="Appendix:-Hankel-transform"><a class="docs-heading-anchor" href="#Appendix:-Hankel-transform">Appendix: Hankel transform</a><a id="Appendix:-Hankel-transform-1"></a><a class="docs-heading-anchor-permalink" href="#Appendix:-Hankel-transform" title="Permalink"></a></h2><p>The Fourier transform of <span>$f(\mathbf{r})$</span> can also be obtained using Hankel transform <sup class="footnote-reference"><a id="citeref-Hankel" href="#footnote-Hankel">[Hankel]</a></sup>,</p><p class="math-container">\[\begin{aligned}
F_{\nu }(k) &amp;= \int _{0}^{\infty } f(r) J_{\nu }(kr) \,r \, \mathrm{d} r, \\
f(r) &amp;= \int _{0}^{\infty } F_{\nu }(k) J_{\nu }(kr) \,k \, \mathrm{d} k,
\end{aligned}\]</p><p>where <span>$\nu \in \mathbb{C}$</span>, <span>$J_{\nu }(x)$</span> is the Bessel function; for integer <span>$n$</span>, the spherical Bessel function <span>$j_{n}(x)$</span> is related to the Bessel function by</p><p class="math-container">\[j_{n}(x) = {\sqrt {\frac {\pi }{2x}}} J_{n + {\frac{1}{2}}}(x).\]</p><p>By using the relation between Fourier transform and Hankel transform <sup class="footnote-reference"><a id="citeref-Hankel" href="#footnote-Hankel">[Hankel]</a></sup>, we can write the Fourier transform as</p><p class="math-container">\[\hat{f}(\mathbf{q}) = (2\pi)^{\frac{3}{2}} (-i)^{l} R_{l}(q) Y_{l m}(\mathbf{q}/q),\]</p><p>where</p><p class="math-container">\[\begin{aligned}
R_{l}(q)
&amp;= \frac{1}{\sqrt{q}} \int_{{\mathbb R}^+} \sqrt{r} R(r) J_{l+\frac{1}{2}}(q r) r dr \\
&amp;= \sqrt{\frac{2}{\pi}} \int_{{\mathbb R}^+} r^2 R(r) \ j_{l}(q r) dr,
\end{aligned}\]</p><p>restoring the same equation.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-SphHarm"><a class="tag is-link" href="#citeref-SphHarm">SphHarm</a><a href="https://en.wikipedia.org/wiki/Spherical_harmonics#Real_form">https://en.wikipedia.org/wiki/Spherical_harmonics#Real_form</a></li><li class="footnote" id="footnote-SphBess"><a class="tag is-link" href="#citeref-SphBess">SphBess</a><a href="https://en.wikipedia.org/wiki/Bessel_function#Spherical_Bessel_functions">https://en.wikipedia.org/wiki/Bessel_function#Spherical_Bessel_functions</a></li><li class="footnote" id="footnote-PwExpand"><a class="tag is-link" href="#citeref-PwExpand">PwExpand</a><a href="https://en.wikipedia.org/wiki/Plane-wave_expansion">https://en.wikipedia.org/wiki/Plane-wave_expansion</a></li><li class="footnote" id="footnote-Hankel"><a class="tag is-link" href="#citeref-Hankel">Hankel</a><a href="https://en.wikipedia.org/wiki/Hankel_transform">https://en.wikipedia.org/wiki/Hankel_transform</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../discretization/">« <span>$k$</span>-space Discretization</a><a class="docs-footer-nextpage" href="../algorithm/">Localization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 30 January 2024 19:06">Tuesday 30 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
